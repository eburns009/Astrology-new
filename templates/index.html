<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Astrology Lab</title>
  <style>
    body{background:#cce7ff;font-family:system-ui;margin:0;padding:20px}
    .wrap{max-width:1100px; margin:0 auto}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>It runs ðŸŽ‰</h1>
    <form method="POST">
      <label>Date <input name="date" value="{{ (form and form.date) or '1962-07-02' }}"></label>
      <label>Hour
        <select name="hour">{% for h in range(1,13) %}<option value="{{h}}" {% if form and form.hour|int==h %}selected{% endif %}>{{h}}</option>{% endfor %}</select>
      </label>
      <label>Minute
        <select name="minute">{% for m in range(0,60,5) %}<option value="{{m}}" {% if form and form.minute|int==m %}selected{% endif %}>{{"%02d"|format(m)}}</option>{% endfor %}</select>
      </label>
      <select name="ampm"><option {% if not form or form.ampm=='AM' %}selected{% endif %}>AM</option><option {% if form and form.ampm=='PM' %}selected{% endif %}>PM</option></select>
      <button type="submit">Compute</button>
    </form>

    {% if page_error %}<p style="color:red">{{page_error}}</p>{% endif %}
    {% if results %}
      <h2>Positions ({{ form.zodiac }})</h2>
      <table border="1" cellpadding="6">
        <tr><th>Body</th><th>Longitude</th><th>Sign</th></tr>
        {% for r in results %}
          {% if form.zodiac=='sidereal' %}
            <tr><td>{{r.name}}</td><td>{{'%.2f'|format(r.sid)}}</td><td>{{r.sid_sign}}</td></tr>
          {% else %}
            <tr><td>{{r.name}}</td><td>{{'%.2f'|format(r.trop)}}</td><td>{{r.trop_sign}}</td></tr>
          {% endif %}
        {% endfor %}
      </table>
    {% endif %}

    <h2>Chart</h2>
    <img src="/chart.svg" width="300" height="300">
  </div>
</body>
</html>
