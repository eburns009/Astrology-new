<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Astrology Lab — Tropical + Fagan/Allen (Fagan/Bradley) Baseline</title>
  <style>
    :root { --bg:#0b0c10; --card:#11131a; --muted:#a7b0c0; --text:#e8ecf3; --accent:#7cc7ff; }
    html,body{background:var(--bg); color:var(--text); font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; margin:0}
    .wrap{max-width:1100px; margin:24px auto; padding:0 16px}
    h1{margin:.2rem 0 1rem 0; font-size:1.5rem}
    .nav{display:flex; gap:8px; flex-wrap:wrap; margin-bottom:12px}
    .tab{padding:.5rem .75rem; border:1px solid #273246; border-radius:999px; color:var(--muted); text-decoration:none}
    .tab.active{background:#162032; color:#dff0ff; border-color:#2d3a51}
    .card{background:var(--card); border:1px solid #22283a; border-radius:12px; padding:14px; margin:10px 0}
    .row{display:flex; gap:12px; flex-wrap:wrap; align-items:end}
    label{display:block; color:#c7d0df; margin-bottom:4px}
    input,select,button{padding:.5rem .6rem; border-radius:10px; border:1px solid #2b3245; background:#0f1320; color:#e8ecf3}
    button{cursor:pointer; background:#14324a}
    button.primary{background:#1b5c85; border-color:#2a81b8}
    table{width:100%; border-collapse:collapse; margin-top:10px}
    th,td{border:1px solid #2a3042; padding:.5rem; text-align:left}
    .muted{color:var(--muted)}
    .err{color:#ff9aa2}
    .grid{display:grid; grid-template-columns:repeat(12,1fr); gap:12px}
    .col-6{grid-column:span 6}
    .col-12{grid-column:span 12}
    @media (max-width: 800px){ .col-6{grid-column:span 12} }
    .wheel{width:320px; height:320px; background:#0f1320; border-radius:50%; border:1px solid #2a3042; display:grid; place-items:center; color:#6ea8ff}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Astrology Lab</h1>
    <div class="nav">
      <a class="tab active" href="#calc">Calc</a>
      <a class="tab" href="#ephem">Ephemeris</a>
      <a class="tab" href="#transits">Transits/Progressions</a>
      <a class="tab" href="#wheel">Chart Wheels</a>
      <a class="tab" href="#stars">Fixed Stars</a>
      <a class="tab" href="#data">Data</a>
    </div>

    <!-- Calc card -->
    <div id="calc" class="card">
      <form method="POST" action="/" class="row">
        <div>
          <label>Date (YYYY-MM-DD)</label>
          <input name="date" value="{{ date or '1962-07-02' }}" />
        </div>
        <div>
          <label>Time (HH:MM)</label>
          <input name="time" value="{{ time or '23:33' }}" />
        </div>
        <div>
          <label>Timezone (IANA)</label>
          <input name="tzid" value="{{ tzid or 'America/New_York' }}" />
        </div>
        <div>
          <label><input type="checkbox" name="use_fixed" {% if use_fixed %}checked{% endif %}/> Use fixed UTC offset (no DST)</label>
        </div>
        <div>
          <label>Fixed UTC offset (h)</label>
          <input name="fixed_offset" value="{{ fixed_offset if fixed_offset is not none else '-5' }}" />
        </div>
        <div>
          <label>FB extra offset (°)</label>
          <input name="fb_offset" value="{{ fb_offset if fb_offset is not none else '0.0' }}" />
        </div>
        <div>
          <button class="primary" type="submit">Compute</button>
        </div>
      </form>

      {% if page_error %}
      <p class="err"><b>Error:</b> {{ page_error }}</p>
      {% endif %}

      {% if results %}
      <p class="muted">Local {{ local_str }} ({{ tzid_display }}) → UTC {{ utc_str }} • JD {{ jd }} • Ayanāṃśa (F/B + extra): {{ ayan_used }}°</p>
      <table>
        <tr>
          <th>Body</th>
          <th>Tropical (°)</th>
          <th>Tropical Sign</th>
          <th>Sidereal F/B (°)</th>
          <th>Sidereal Sign</th>
        </tr>
        {% for r in results %}
          <tr>
            <td>{{ r.name }}</td>
            <td>{{ r.trop }}</td>
            <td>{{ r.trop_sign }}</td>
            <td>{{ r.sid }}</td>
            <td>{{ r.sid_sign }}</td>
          </tr>
        {% endfor %}
      </table>
      {% endif %}
    </div>

    <!-- Ephemeris (placeholder UI) -->
    <div id="ephem" class="card">
      <div class="grid">
        <div class="col-12">
          <p class="muted"><b>Ephemeris (Fagan/Allen)</b> — choose a date range and step; results will be printable. (Coming next.)</p>
        </div>
        <div class="col-6">
          <label>Start date</label>
          <input name="eph_start" placeholder="-0500-01-01 (BCE supported)" />
        </div>
        <div class="col-6">
          <label>End date</label>
          <input name="eph_end" placeholder="1962-07-02" />
        </div>
        <div class="col-6">
          <label>Step</label>
          <select name="eph_step">
            <option>1 day</option>
            <option>6 hours</option>
            <option>1 hour</option>
          </select>
        </div>
        <div class="col-6">
          <label>Center</label>
          <select name="eph_center">
            <option value="geo">Geocentric</option>
            <option value="helio">Heliocentric</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Transits / Progressions (placeholder UI) -->
    <div id="transits" class="card">
      <p class="muted">Transit &amp; Secondary Progression searches (Fagan/Allen sidereal). We’ll add a query builder (e.g., find all times Mars ☐ natal Sun).</p>
    </div>

    <!-- Chart wheels (placeholder UI) -->
    <div id="wheel" class="card">
      <div class="row">
        <div>
          <label>Wheel Type</label>
          <select name="wheel_type">
            <option>Single Wheel</option>
            <option>Bi-Wheel</option>
            <option>Tri-Wheel</option>
          </select>
        </div>
        <div>
          <label>House System</label>
          <select name="house_system">
            <option value="EQUAL">Equal (Asc in middle of 1st)</option>
            <option value="PLACIDUS">Placidus</option>
          </select>
        </div>
        <div>
          <label><input type="checkbox" name="clockwise" /> Clockwise houses</label>
        </div>
      </div>
      <div class="wheel">SVG wheel preview (placeholder)</div>
    </div>

    <!-- Fixed Stars (placeholder UI) -->
    <div id="stars" class="card">
      <p class="muted">Fixed star ephemeris aligned to Fagan/Allen (Swiss Ephemeris fixed stars). Search &amp; print coming.</p>
    </div>

    <!-- Data (placeholder UI) -->
    <div id="data" class="card">
      <p class="muted">Chart library &amp; search — store/retrieve natal and event charts, tag, and query by planetary positions.</p>
    </div>

  </div>
</body>
</html>

